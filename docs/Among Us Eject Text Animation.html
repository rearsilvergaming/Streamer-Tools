<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Two-Line Eject Animation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=VT323&display=swap");

      .eject-line {
        font-family: "VT323", monospace;
        font-size: 5rem;
        color: #fff;
        white-space: nowrap;
        overflow: hidden;
        width: 0;
        letter-spacing: 0.15em;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
        margin: 0;
        padding: 0;
        line-height: 1.2;
      }

      .cursor {
        border-right: 0.15em solid white;
      }

      @keyframes blink-caret {
        from,
        to {
          border-color: transparent;
        }
        50% {
          border-color: white;
        }
      }
    </style>
  </head>

  <body class="bg-transparent flex items-center justify-center min-h-screen">
    <div id="parent-container" class="text-center transition-opacity duration-500">
      <div id="line-one" class="eject-line"></div>
      <div id="line-two" class="eject-line"></div>
    </div>

    <script>
      // --- Get username from URL (?user=xxx) ---
      const params = new URLSearchParams(window.location.search);
      let username = params.get("user") || "A user";

      // Optional: clean up the username (remove URL encoding etc.)
      username = decodeURIComponent(username);

      // --- Define text ---
      const lineOneText = `${username} was`;
      const lineTwoText = `ejected from the stream.`;

      const elOne = document.getElementById("line-one");
      const elTwo = document.getElementById("line-two");
      const parentContainer = document.getElementById("parent-container");

      // Animation constants
      const CHAR_DELAY_S = 0.09;
      const CURSOR_STOP_DELAY_MS = 500;
      const HOLD_TIME_MS = 5000;
      const FADE_TIME_MS = 500;

      // --- Create keyframes dynamically (once) ---
      function createTypingKeyframes() {
        const styleSheet = document.styleSheets[0];
        const rule = `
          @keyframes typing-dynamic {
            from { width: 0 }
            to { width: 100% }
          }
        `;
        if (![...styleSheet.cssRules].some(r => r.name === "typing-dynamic")) {
          styleSheet.insertRule(rule, styleSheet.cssRules.length);
        }
      }

      // --- Animation: Line 1 ---
      function typeLineOne() {
        elOne.textContent = lineOneText;
        const numSteps1 = lineOneText.length;
        const typingDuration1 = numSteps1 * CHAR_DELAY_S;

        elOne.classList.add("cursor");
        elOne.style.animation =
          `typing-dynamic ${typingDuration1}s steps(${numSteps1}) forwards, blink-caret 0.75s step-end infinite`;

        setTimeout(() => {
          elOne.classList.remove("cursor");
          elOne.style.borderRight = "none";
          elOne.style.animation = "none";
          elOne.style.width = "fit-content";
          typeLineTwo();
        }, typingDuration1 * 1000 + CURSOR_STOP_DELAY_MS);
      }

      // --- Animation: Line 2 ---
      function typeLineTwo() {
        elTwo.textContent = lineTwoText;
        const numSteps2 = lineTwoText.length;
        const typingDuration2 = numSteps2 * CHAR_DELAY_S;

        elTwo.classList.add("cursor");
        elTwo.style.animation =
          `typing-dynamic ${typingDuration2}s steps(${numSteps2}) forwards, blink-caret 0.75s step-end infinite`;

        setTimeout(() => {
          elTwo.classList.remove("cursor");
          elTwo.style.borderRight = "none";
          elTwo.style.animation = "none";
          elTwo.style.width = "fit-content";
          startCleanup();
        }, typingDuration2 * 1000 + CURSOR_STOP_DELAY_MS);
      }

      // --- Fade out after hold ---
      function startCleanup() {
        setTimeout(() => {
          parentContainer.style.opacity = "0";
          setTimeout(() => {
            parentContainer.style.display = "none";
          }, FADE_TIME_MS);
        }, HOLD_TIME_MS);
      }

      // --- Initialise ---
      createTypingKeyframes();
      typeLineOne();
    </script>
  </body>
</html>
