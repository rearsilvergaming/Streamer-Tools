<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timeout Eject Animation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Integrated VT323 font from Ban Code */
      @import url("https://fonts.googleapis.com/css2?family=VT323&display=swap");

      /* Styles common to all animated lines, adapted from eject-line */
      .eject-line {
        font-family: "VT323", monospace;
        font-size: 5rem; /* Large text, matching Ban code's size */
        color: #fff;
        /* These three rules are crucial for the typing effect: */
        white-space: nowrap; /* Forces content onto one line */
        overflow: hidden; /* Hides untyped text */
        width: 0; /* Starts with zero width for animation */
        
        letter-spacing: 0.15em;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 4px 4px 0 #000;
        margin: 0; 
        padding: 0; 
        line-height: 1.2; 
      }

      /* The cursor style (only applied dynamically to the active line) */
      .cursor {
        border-right: 0.15em solid white;
        animation: blink-caret 0.75s step-end infinite;
      }

      /* Keyframes for the blinking cursor */
      @keyframes blink-caret {
        from,
        to {
          border-color: transparent;
        }
        50% {
          border-color: white;
        }
      }
      
      /* Dynamic typing keyframe will be created in JS, based on Ban code */

      /* Colouring styles from the original Timeout code */
      .username {
        color: #ff5050;
      }
      .mod {
        color: #50b3ff;
      }
      .duration {
        color: #ffff50;
      }
      .reason {
        color: #a0ff90;
      }
    </style>
  </head>
  <body class="bg-transparent flex items-center justify-center min-h-screen">
    <div
      id="parent-container"
      class="text-center transition-opacity duration-500"
    >
      <div id="line-one" class="eject-line"></div>
      <div id="line-two" class="eject-line"></div>
      <div id="line-three" class="eject-line reason"></div>
      <div id="line-four" class="eject-line"></div>
    </div>

    <script>
      // --- Utility Functions ---
      function decodeBase64(str) {
        try {
          return decodeURIComponent(
            atob(str)
              .split("")
              .map((c) => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2))
              .join("")
          );
        } catch {
          return str; // fallback if not valid base64
        }
      }
      
      // Function to dynamically create the typing keyframes (from Ban code)
      // This is now simplified back to the original dynamic 'typing-dynamic'
      function createTypingKeyframes() {
        const styleSheet = document.styleSheets[0];
        const rule = `
        @keyframes typing-dynamic {
          from { width: 0 }
          to { width: 100% }
        }
      `;
        if (
          ![...styleSheet.cssRules].some((r) => r.name === "typing-dynamic")
        ) {
          styleSheet.insertRule(rule, styleSheet.cssRules.length);
        }
      }

      // --- Get Parameters and Define Content ---
      const params = new URLSearchParams(window.location.search);
      let rawUser = params.get("user") || "A user";
      let username = decodeBase64(rawUser); 

      const mod = decodeURIComponent(params.get("mod") || "a Moderator");
      const duration = decodeURIComponent(params.get("duration") || "300s");
      const reason = decodeURIComponent(
        params.get("reason") || "No reason given."
      );

      // --- Define element references ---
      const elOne = document.getElementById("line-one");
      const elTwo = document.getElementById("line-two");
      const elThree = document.getElementById("line-three");
      const elFour = document.getElementById("line-four");
      const parentContainer = document.getElementById("parent-container");
      
      // --- Define Line Content (including HTML for colour) ---
      const lineOneHTML = `<span class="username">${username}</span> was timed out`;
      const lineTwoHTML = `By <span class="mod">${mod}</span> for <span class="duration">${duration}</span>`;
      const lineThreeText = reason;
      const lineFourText = ""; // Blank line for the final cursor effect

      // --- Animation Constants ---
      const CHAR_DELAY_S = 0.09;
      const CURSOR_STOP_DELAY_MS = 500;
      const HOLD_TIME_MS = 5000;
      const FADE_TIME_MS = 500;

      // --- Animation Core Logic ---

      /**
       * Generic function to type out a single line.
       * @param {HTMLElement} el - The line element to type.
       * @param {string} content - The HTML/Text content to insert and type out.
       * @param {function} nextFunction - The function to call after this line is typed.
       */
      function typeLine(el, content, nextFunction) {
        // 1. Insert content just before typing starts
        el.innerHTML = content;
        
        // 2. We use the length of the *text content* to determine the steps.
        // This is safer than HTML length for the step count.
        const numSteps = el.textContent.length; 
        const typingDuration = numSteps * CHAR_DELAY_S;
        
        // We ensure the animation width targets 100% of the *content's* width.
        // This is reliable when the CSS has white-space: nowrap and overflow: hidden.
        
        el.classList.add("cursor");
        el.style.animation =
          `typing-dynamic ${typingDuration}s steps(${numSteps}) forwards`;

        setTimeout(() => {
          // Stop cursor blink and remove cursor style
          el.classList.remove("cursor");
          el.style.borderRight = "none";
          el.style.animation = "none";
          
          // Ensure the width is set to its content size after animation stops
          el.style.width = "fit-content";
          
          // Move to the next line after a short delay
          setTimeout(nextFunction, CURSOR_STOP_DELAY_MS);
        }, typingDuration * 1000);
      }
      
      // Define the sequence of line typing
      
      // 1. Type Line 1: [User] was timed out
      function typeLineOne() {
        typeLine(elOne, lineOneHTML, typeLineTwo);
      }

      // 2. Type Line 2: By [Mod] for [Duration]
      function typeLineTwo() {
        typeLine(elTwo, lineTwoHTML, typeLineThree);
      }

      // 3. Type Line 3: [Reason]
      function typeLineThree() {
        // Line 3 only contains text, so we can pass it directly
        typeLine(elThree, lineThreeText, typeLineFour);
      }
      
      // 4. Type Line 4 (Final line, blank, for final cursor effect)
      function typeLineFour() {
        typeLine(elFour, lineFourText, startCleanup);
      }

      // --- Fade Out ---
      function startCleanup() {
        // Hold the final state for the specified time
        setTimeout(() => {
          parentContainer.style.opacity = "0"; // Trigger fade out

          // After fade out is complete, hide the element completely
          setTimeout(() => {
            parentContainer.style.display = "none";
          }, FADE_TIME_MS);
        }, HOLD_TIME_MS);
      }

      // --- Start Sequence ---
      createTypingKeyframes();
      typeLineOne();
    </script>
  </body>
</html>
